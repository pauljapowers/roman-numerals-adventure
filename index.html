<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Roman Numerals Adventure</title>

    <!--
        Basic styling: background stripes, centered white card, buttons, sections,
        arena layout, character selection, and history facts.
    -->
    <style>
        body {
            font-family: Arial, sans-serif;
            background: url("images/ancient-rome.png") no-repeat center center fixed;
            margin: 0;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
        }

        h1 {
            text-align: center;
        }

        /* Top nav buttons */
        #nav {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 8px;
            margin-bottom: 20px;
        }

        button {
            padding: 8px 12px;
            cursor: pointer;
        }

        /* Each main section (Story, Tutorial, etc.) */
        .section {
            display: none;
        }

        /* Bottom‑right guide character and speech bubble */
        #character {
            position: fixed;
            bottom: 10px;
            right: 10px;
            width: 180px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 8px;
            padding: 5px;
            box-shadow: 0 0 4px rgba(0,0,0,0.3);
        }

        #character img {
            max-width: 100%;
            display: block;
        }

        #speech {
            background: #fff;
            border: 1px solid #ccc;
            padding: 5px;
            border-radius: 5px;
            margin-top: 5px;
            font-size: 0.9rem;
        }

        /* Generic draggable tiles (for builder + matching) */
        .draggable {
            display: inline-block;
            padding: 10px;
            background: #eee;
            margin: 5px;
            cursor: move;
            border-radius: 4px;
        }

        /* Dropzone for the numeral builder */
        #dropzone {
            border: 2px dashed #000;
            min-height: 50px;
            padding: 10px;
            margin: 10px 0;
        }

        /* Matching game layout */
        #matching .pair {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 10px 0;
        }

        #matching .drop {
            border: 1px solid #000;
            width: 100px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Content images (tutorial, story, etc.) */
        img.content-image {
            max-width: 100%;
            height: auto;
            margin: 10px 0;
            border-radius: 6px;
        }

        /* Arena layout: hero vs monster */
        #battle-arena {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 10px 0 20px 0;
        }

        .fighter img {
            max-width: 150px;
        }

        #health-bars {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-weight: bold;
        }

        /* Character‑select thumbnails */
        #character-options img {
            max-width: 120px;
            margin: 5px;
            cursor: pointer;
            border: 3px solid transparent;
            border-radius: 8px;
        }

        #character-options img.selected {
            border-color: #5a94ff;
        }

        input[type="text"] {
            padding: 5px;
            margin-top: 5px;
        }

        #history-facts p {
            margin-bottom: 8px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Roman Numerals Adventure</h1>

        <!--
            Navigation bar. Each button shows one section.
            Player name is used on the certificate.
        -->
        <div id="nav">
          <button onclick="showSection('story')">Story</button>
          <button onclick="showSection('tutorial')">Tutorial</button>
          <button onclick="showSection('character-select')">Character</button>
          <button onclick="showSection('history')">History</button>
          <button onclick="showSection('tools')">Tools</button>
          <button onclick="showSection('quiz')">Arena</button>
          <button onclick="downloadCertificate()">Certificate</button>
          <button onclick="showSection('highscore')">High Score</button>
          <input type="text" id="player-name" placeholder="Your name" />
        </div>

        <!-- STORY / NARRATIVE -->
        <div id="story" class="section">
            <h2>Story</h2>
            <div style="display:flex; align-items:center; gap:16px; margin-top:20px;">
              <img src="images/monster-1-faun-1.png" alt="Faun herald" style="max-width:120px;">
              <p>
                “Salve! I am your guide, Cato! 
                Cato means "wise" or "shrewd," and my name is often associated with the famous stoic philosopher.
                ... I will guide you through Rome and explain how to use this site to learn all about Roman Numerals and Ancient Rome.
                Read your story below, then follow the buttons above to learn all about Roman numbers,
                explore our city, and prove your skills in the Arena where you will combat XX monsters by proving your maths skills!”
                <em>XX in Roman Numerals = 20 in your modern numbers</em>                     
              </p>
            </div>
            
            <div style="background-color: #fffde7; border: 1px solid #ffd54f; border-left: 5px solid #fbc02d; padding: 15px; margin-top: 10px; border-radius: 4px; font-family: sans-serif;">
                <strong>Did you know?</strong> 
                <i>(Cato is pronounced in Ancient Latin as KAH-toh sounded out like /ˈkaːtoː/)
                Classical Latin Pronunciation: Historians and Latin students typically use "KAH-toh". 
                In this version, the "a" is a short, open sound like the "a" in "father"</i>
            </div> 
            
            <p>
                You are a young scribe in ancient Rome, chosen by the Senate to keep
                track of armies, festivals, and treasure. To prove yourself, you must
                master Roman numerals and defeat legendary beasts in the Arena of Numbers.
            </p>
            <p>
                Each victory unlocks new secrets about Rome’s history and language.
                Learn new words like <strong>legion</strong> (a large Roman army),
                <strong>Senate</strong> (the council of leaders), and
                <strong>scribe</strong> (a person who writes official records).
            </p>
            <h3>How to use this adventure</h3>
            <ol style="margin-left: 1.5rem;">
              <li>Start with the <strong>Story</strong> and <strong>Tutorial</strong> pages to learn the basics.</li>
              <li>Choose your hero on the <strong>Character</strong> page.</li>
              <li>Visit the <strong>History</strong> page to unlock facts as you win battles.</li>
              <li>Train in the <strong>Tools</strong> section: Converter, Builder, and Matching games.</li>
              <li>Fight monsters in the <strong>Arena</strong> and climb through levels I to XX.</li>
              <li>When you are ready, download your <strong>Certificate</strong> and add your name to the Hall of Fame.</li>
            </ol>
            <!-- Background art: ancient Rome -->
            <img src="images/ancient-rome.png"
                 alt="Ancient Roman forum with temples and people"
                 class="content-image" />
        </div>

        <!-- TUTORIAL (rules + clock image) -->
        <div id="tutorial" class="section">
            <h2>Tutorial</h2>
            <div style="display:flex; align-items:center; gap:16px; margin-top:20px;">
              <img src="images/monster-1-faun-2.png" alt="Faun teacher" style="max-width:120px;">
              <p>
                “I, Faun, will teach you! First, read the rules above. Next, look at the clock
                and say each numeral from I to XII. Then visit the Tools to practise. When you can
                read every numeral quickly, you are ready for the Arena!”
              </p>
            </div>
            <p>Rules: I = 1, V = 5, X = 10, L = 50, C = 100, D = 500, M = 1000.</p>
            <p>Subtractive forms: IV = 4, IX = 9, XL = 40, XC = 90, CD = 400, CM = 900.</p>
            <!-- Clock art showing Roman numerals -->
            <img src="images/roman-clock.png"
                 alt="Clock face with Roman numerals"
                 class="content-image" />
            <p>
                Modern use: Roman numerals still appear on clocks, in book chapters,
                and at the end of films (for example, MMXXVI = 2026).
            </p>
            <h3>How to use this site (Step‑by‑step)</h3>
            <ol style="list-style-type: upper-roman; margin-left: 1.5rem;">
              <li>Read the rules for Roman numerals at the top of this page.</li>
              <li>Look at the clock and say each numeral out loud from I to XII.</li>
              <li>Use the <strong>Converter</strong> to practise turning numbers into numerals and back.</li>
              <li>Use the <strong>Builder</strong> to drag I, V, X, L, C, D, M and see how they combine.</li>
              <li>Play the <strong>Matching</strong> game to speed up your recognition.</li>
              <li>Enter the <strong>Arena</strong> when you feel ready to battle with maths.</li>
            </ol>
        </div>

        <!-- CONVERTER -->
        <div id="converter" class="section">
            <div style="display:flex; align-items:center; gap:16px; margin-top:20px;">
          <img src="images/monster-1-faun-left-1.png" alt="Faun helper" style="max-width:120px;">
          <p>
            “Type a regular number, like <strong>27</strong>, and press Convert to see its Roman
            numeral (<strong>XXVII</strong>). Or type a Roman numeral, like <strong>XL</strong>,
            to see the number <strong>40</strong>. Practise until you can guess the answer
            before the converter shows it!”
          </p>
        </div>
            <h2>Converter</h2>
            <input type="text" id="input" placeholder="Number or Roman">
            <button onclick="convertInput()">Convert</button>
            <div id="result"></div>
        </div>        

        <!-- DRAG‑AND‑DROP BUILDER -->
        <div id="builder" class="section">
            <div style="display:flex; align-items:center; gap:16px; margin-top:20px;">
              <img src="images/monster-1-faun-left-1.png" alt="Faun helper" style="max-width:120px;">
              <p>
                “Type a regular number, like <strong>27</strong>, and press Convert to see its Roman
                numeral (<strong>XXVII</strong>). Or type a Roman numeral, like <strong>XL</strong>,
                to see the number <strong>40</strong>. Welcome Roman! Here is a tricky game for you to play!”
              </p>
            </div>
            <h2>Drag-and-Drop Builder</h2>
            <p>Drag symbols to build a Roman numeral and see its value.</p>
            <div>
                <div class="draggable" draggable="true" ondragstart="drag(event)" id="I">I</div>
                <div class="draggable" draggable="true" ondragstart="drag(event)" id="V">V</div>
                <div class="draggable" draggable="true" ondragstart="drag(event)" id="X">X</div>
                <div class="draggable" draggable="true" ondragstart="drag(event)" id="L">L</div>
                <div class="draggable" draggable="true" ondragstart="drag(event)" id="C">C</div>
                <div class="draggable" draggable="true" ondragstart="drag(event)" id="D">D</div>
                <div class="draggable" draggable="true" ondragstart="drag(event)" id="M">M</div>
            </div>
            <div id="dropzone" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
            <div id="build-result"></div>
            <button onclick="resetBuilder()">Reset</button>
        </div>

        <!-- CHARACTER SELECTION -->
        <div id="character-select" class="section">
            <h2>Choose Your Champion</h2>
            <p>Select a character to guide you through the Arena of Numbers.</p>
            <div id="character-options">
                <!-- Exact filenames from your image folder -->
                <img src="images/roman-character-1.png" alt="Centurion"
                     id="char-centurion" onclick="selectCharacter('centurion')" />
                <img src="images/roman-character-2.png" alt="Scholar"
                     id="char-scholar" onclick="selectCharacter('scholar')" />
            </div>
        </div>

        <!-- ARENA / BATTLE QUIZ -->
        <div id="quiz" class="section">
            <h2>Arena Battle</h2>
            <p>
                Level <span id="level">1</span>.
                Total score: <span id="score">0</span>
            </p>
            <p>Each battle has up to 10 questions. Correct answers damage the monster, wrong answers hurt you!</p>

            <div id="health-bars">
                <div>Hero HP: <span id="hero-hp">5</span></div>
                <div>Monster HP: <span id="monster-hp">5</span></div>
            </div>

            <div id="battle-arena">
                <div class="fighter">
                    <!-- Hero image (centurion or scholar) -->
                    <img id="hero-img" src="images/roman-character-1.png" alt="Hero">
                </div>
                <div class="fighter">
                    <!-- Monster: faun facing left (as in your screenshot) -->
                    <img id="monster-img" src="images/monster-1-faun-right-2.png" alt="Faun monster">
                </div>
            </div>

            <p>Round score: <span id="round-score">0</span> / 10</p>
            <div id="question"></div>
            <input type="text" id="quiz-input" autocomplete="off">
            <button onclick="checkQuiz()">Submit</button>
            <div id="quiz-result"></div>
        </div>

        <!-- MATCHING GAME -->
        <div id="matching" class="section">
            <div style="display:flex; align-items:center; gap:16px; margin-top:20px;">
              <img src="images/monster-1-faun-left-1.png" alt="Faun helper" style="max-width:120px;">
              <p>
                “Type a regular number, like <strong>27</strong>, and press Convert to see its Roman
                numeral (<strong>XXVII</strong>). Or type a Roman numeral, like <strong>XL</strong>,
                to see the number <strong>40</strong>. Rome wasn't built in a day! Practice makes perfect!”
              </p>
            </div>
            <h2>Matching Game</h2>
            <p>Drag Roman numerals to match the numbers.</p>
            <div>
                <div class="draggable" draggable="true" ondragstart="drag(event)" id="match-I">I</div>
                <div class="draggable" draggable="true" ondragstart="drag(event)" id="match-V">V</div>
                <div class="draggable" draggable="true" ondragstart="drag(event)" id="match-X">X</div>
            </div>
            <div class="pair">5:
                <div class="drop" ondrop="dropMatch(event, 5)" ondragover="allowDrop(event)"></div>
            </div>
            <div class="pair">1:
                <div class="drop" ondrop="dropMatch(event, 1)" ondragover="allowDrop(event)"></div>
            </div>
            <div class="pair">10:
                <div class="drop" ondrop="dropMatch(event, 10)" ondragover="allowDrop(event)"></div>
            </div>
            <div id="match-result"></div>
        </div>

        <!-- HISTORY (UNLOCKABLE FACTS) -->
        <div id="history" class="section">
            <h2>History & Background</h2>
            <p>
                Win battles in the Arena to unlock new secrets about Roman numerals and
                ancient Rome.
            </p>
            <div id="history-facts"></div>
        </div>
    </div>

    <!-- FIXED GUIDE CHARACTER (BOTTOM‑RIGHT) -->
    <div id="character">
        <!-- Uses same hero art; default is centurion -->
        <img id="corner-character" src="images/roman-character-1.png" alt="Guide character">
        <div id="speech">Welcome to the Arena of Numbers!</div>
    </div>

    <!-- HIDDEN CANVAS FOR CERTIFICATE PNG -->
    <canvas id="cert-canvas" style="display:none;"></canvas>

    <script>
        /* ========= GLOBAL STATE & PERSISTENCE ========= */

        // Overall score and level, stored in localStorage
        let score = parseInt(localStorage.getItem('score') || '0', 10);
        let level = parseInt(localStorage.getItem('level') || '1', 10);
        document.getElementById('score').innerText = score;
        document.getElementById('level').innerText = level;

        // Active hero: "centurion" or "scholar"
        let selectedCharacter = 'centurion';

        // Short history facts unlocked as the player levels up
        const historyFacts = [
            "Romans used numerals mainly for counting money, recording trade, and numbering armies.",
            "Romans did not have a symbol for zero. The idea of zero came later from other cultures.",
            "Romans wrote numbers on wax tablets, stone, and metal, often carved into monuments.",
            "On old clocks and buildings you often see 'IIII' for 4 instead of 'IV'.",
            "Roman numerals are still used today for book chapters, movie dates, and royal names."
        ];
        let unlockedFacts = parseInt(localStorage.getItem('factsUnlocked') || '1', 10);

        // Render unlocked facts into the History section
        function renderHistoryFacts() {
            const container = document.getElementById('history-facts');
            container.innerHTML = '';
            for (let i = 0; i < unlockedFacts && i < historyFacts.length; i++) {
                const p = document.createElement('p');
                p.textContent = historyFacts[i];
                container.appendChild(p);
            }
        }

        /* ========= NAVIGATION ========= */

        // Show one section (by id) and hide the others
        function showSection(id) {
            document.querySelectorAll('.section').forEach(s => s.style.display = 'none');
            document.getElementById(id).style.display = 'block';
            if (id === 'quiz') startQuiz();  // entering Arena starts/continues a round
        }

        /* ========= ROMAN NUMERAL UTILITIES ========= */

        // Number -> Roman lookup map
        const romanMap = [
            { value: 1000, numeral: "M" }, { value: 900, numeral: "CM" }, { value: 500, numeral: "D" },
            { value: 400, numeral: "CD" }, { value: 100, numeral: "C" }, { value: 90, numeral: "XC" },
            { value: 50, numeral: "L" }, { value: 40, numeral: "XL" }, { value: 10, numeral: "X" },
            { value: 9, numeral: "IX" }, { value: 5, numeral: "V" }, { value: 4, numeral: "IV" }, { value: 1, numeral: "I" }
        ];

        // Integer -> Roman numeral
        function numberToRoman(num) {
            let result = "";
            for (let { value, numeral } of romanMap) {
                while (num >= value) { result += numeral; num -= value; }
            }
            return result;
        }

        // Roman -> integer lookup
        const romanToNumMap = {
            M: 1000, CM: 900, D: 500, CD: 400,
            C: 100, XC: 90, L: 50, XL: 40,
            X: 10, IX: 9, V: 5, IV: 4, I: 1
        };

        // Roman numeral string -> integer
        function romanToNumber(roman) {
            let i = 0, num = 0;
            roman = roman.toUpperCase();
            while (i < roman.length) {
                let two = roman[i] + (roman[i + 1] || "");
                if (romanToNumMap[two]) { num += romanToNumMap[two]; i += 2; }
                else { num += romanToNumMap[roman[i]]; i++; }
            }
            return num;
        }

        // Converter UI handler
        function convertInput() {
            let input = document.getElementById('input').value.trim().toUpperCase();
            let result = document.getElementById('result');
            if (!input) {
                result.innerText = "Please enter a number or Roman numeral.";
                return;
            }
            if (!isNaN(input)) {
                let num = parseInt(input);
                if (num < 1 || num > 3999) {
                    result.innerText = "Please enter a number from 1 to 3999.";
                } else {
                    result.innerText = numberToRoman(num);
                }
            } else {
                result.innerText = romanToNumber(input);
            }
        }

        /* ========= DRAG & DROP BUILDER ========= */

        function allowDrop(ev) { ev.preventDefault(); }

        function drag(ev) {
            ev.dataTransfer.setData("text", ev.target.id);
        }

        function drop(ev) {
            ev.preventDefault();
            let data = ev.dataTransfer.getData("text");
            let node = document.getElementById(data).cloneNode(true);
            node.id = node.id + "-copy-" + Date.now();  // unique id for clone
            ev.target.appendChild(node);

            // Recalculate the value of the assembled numeral
            let roman = ev.target.innerText.replace(/\s+/g, '');
            document.getElementById('build-result').innerText =
                roman ? romanToNumber(roman) : '';
        }

        function resetBuilder() {
            document.getElementById('dropzone').innerHTML = '';
            document.getElementById('build-result').innerText = '';
        }

        /* ========= CHARACTER SELECTION ========= */

        function selectCharacter(id) {
            selectedCharacter = id;

            // Update bottom‑right portrait
            document.getElementById('speech').innerText = `You chose the ${id}!`;
            document.getElementById('corner-character').src =
                id === 'scholar'
                    ? 'images/roman-character-2.png'
                    : 'images/roman-character-1.png';

            // Visual highlight in character‑select section
            document.querySelectorAll('#character-options img')
                .forEach(img => img.classList.remove('selected'));
            if (id === 'scholar') {
                document.getElementById('char-scholar').classList.add('selected');
            } else {
                document.getElementById('char-centurion').classList.add('selected');
            }
        }

        /* ========= ARENA / QUIZ BATTLE ========= */

        let heroHp = 5;
        let monsterHp = 5;
        let questionsThisRound = 0;
        let currentQuestion = null;

        // Set up or continue the current round
        function startQuiz() {
            // Hero artwork swaps based on selectedCharacter
            document.getElementById('hero-img').src =
                selectedCharacter === 'scholar'
                    ? 'images/roman-character-2.png'
                    : 'images/roman-character-1.png';

            // New round: reset HP and round score
            if (questionsThisRound === 0) {
                heroHp = 5;
                monsterHp = 5;
                document.getElementById('hero-hp').innerText = heroHp;
                document.getElementById('monster-hp').innerText = monsterHp;
                document.getElementById('round-score').innerText = 0;
                document.getElementById('quiz-result').innerText = '';
            }

            // Difficulty scaling by level
            const maxBase = level * 10;
            let a = Math.floor(Math.random() * maxBase) + 1;
            let b = Math.floor(Math.random() * maxBase) + 1;
            let op = '+';
            if (level >= 3 && level <= 4) op = '-';
            if (level >= 5 && level <= 6) op = '×';
            if (level >= 7) op = '÷';

            let correctNumber;
            if (op === '+') {
                correctNumber = a + b;
            } else if (op === '-') {
                const max = Math.max(a, b);
                const min = Math.min(a, b);
                a = max; b = min;
                correctNumber = a - b;
            } else if (op === '×') {
                correctNumber = a * b;
            } else if (op === '÷') {
                // Ensure division questions give integer answers
                correctNumber = a;
                b = Math.max(1, Math.floor(Math.random() * (level + 1)));
                a = correctNumber * b;
            }

            currentQuestion = { a, b, op, correctNumber };
            const romanA = numberToRoman(a);
            const romanB = numberToRoman(b);

            document.getElementById('question').innerText =
                `Arena Challenge: ${romanA} ${op} ${romanB} = ? (answer in Roman numerals)`;
            document.getElementById('quiz-input').value = '';
            document.getElementById('quiz-input').focus();
        }

        // Evaluate the player's answer
        function checkQuiz() {
            if (!currentQuestion) return;

            const input = document.getElementById('quiz-input').value.trim().toUpperCase();
            if (!input) return;

            const result = document.getElementById('quiz-result');
            questionsThisRound++;

            const correctRoman = numberToRoman(currentQuestion.correctNumber);
            const correct = (input === correctRoman);

            if (correct) {
                monsterHp--;
                score++;
                document.getElementById('monster-hp').innerText = monsterHp;
                document.getElementById('round-score').innerText =
                    parseInt(document.getElementById('round-score').innerText) + 1;
                document.getElementById('speech').innerText = 'You strike the monster!';
                result.innerText = 'Correct!';
            } else {
                heroHp--;
                document.getElementById('hero-hp').innerText = heroHp;
                document.getElementById('speech').innerText =
                    `The monster hits back! Correct answer was ${correctRoman}.`;
                result.innerText = `Wrong. Correct: ${correctRoman}`;
            }

            // Persist total score
            localStorage.setItem('score', score);
            document.getElementById('score').innerText = score;

            // End of round conditions
            if (heroHp <= 0 || monsterHp <= 0 || questionsThisRound >= 10) {
                if (monsterHp <= 0 && heroHp > 0) {
                    // Player wins: level up and unlock fact
                    level++;
                    localStorage.setItem('level', level);
                    document.getElementById('level').innerText = level;

                    if (unlockedFacts < historyFacts.length) {
                        unlockedFacts++;
                        localStorage.setItem('factsUnlocked', unlockedFacts);
                        renderHistoryFacts();
                        document.getElementById('speech').innerText =
                            'Victory! You move to the next arena and unlock a new secret of Rome.';
                    } else {
                        document.getElementById('speech').innerText =
                            'Victory! You have uncovered all the known secrets of Rome.';
                    }
                } else if (heroHp <= 0) {
                    document.getElementById('speech').innerText =
                        'Defeat... but you can try the level again.';
                }
                questionsThisRound = 0; // next time startQuiz() runs, it resets HP etc.
            }

            if (heroHp > 0 && monsterHp > 0 && questionsThisRound < 10) {
                startQuiz();
            }
        }

        /* ========= MATCHING GAME ========= */

        function dropMatch(ev, num) {
            ev.preventDefault();
            let data = ev.dataTransfer.getData("text");
            let symbol = document.getElementById(data).innerText.trim();
            if (romanToNumber(symbol) === num) {
                ev.target.innerText = symbol;
                document.getElementById('match-result').innerText = 'Match!';
                document.getElementById('speech').innerText = 'Good match!';
            } else {
                document.getElementById('match-result').innerText = 'Try again.';
                document.getElementById('speech').innerText = 'No match.';
            }
        }

        /* ========= CERTIFICATE (CANVAS) ========= */

function downloadCertificate() {
    const canvas = document.getElementById('cert-canvas');
    const ctx = canvas.getContext('2d');
    const name = document.getElementById('player-name').value || 'Brave Student';

    canvas.width = 800;
    canvas.height = 600;

    // Background
    ctx.fillStyle = '#fdf6e3';
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    // Border
    ctx.strokeStyle = '#8b5a2b';
    ctx.lineWidth = 10;
    ctx.strokeRect(20, 20, canvas.width - 40, canvas.height - 40);

    ctx.fillStyle = '#000';
    ctx.textAlign = 'center';

    // Titles
    ctx.font = '36px Georgia';
    ctx.fillText('Certificate of Achievement', canvas.width / 2, 100);
    ctx.font = '28px Georgia';
    ctx.fillText('Roman Numerals Adventure', canvas.width / 2, 150);

    // Hero + name
    ctx.font = '24px Georgia';
    ctx.fillText(name, canvas.width / 2, 210);
    ctx.font = '20px Georgia';
    const heroLabel = selectedCharacter === 'scholar' ? 'Scholar of Numbers' : 'Centurion of Counting';
    ctx.fillText(heroLabel, canvas.width / 2, 240);

    // Score and level (Roman + Arabic)
    const levelRoman = numberToRoman(level);
    ctx.fillText(`Score: ${score}`, canvas.width / 2, 280);
    ctx.fillText(`Level: ${levelRoman} (${level} of XX)`, canvas.width / 2, 310);

    // Monster text line
    ctx.font = '18px Georgia';
    ctx.fillText(
        `Well done, ${name}! You defeated the trickster known as Faun.`,
        canvas.width / 2, 350
    );

    // Insert small faun logo at bottom
    const logo = new Image();
    logo.src = 'images/monster-1-faun-left-1.png';
    logo.onload = () => {
        const logoSize = 100;
        ctx.drawImage(logo, canvas.width / 2 - logoSize / 2, 370, logoSize, logoSize);

        // Footer and date after logo loads
        ctx.font = '16px Georgia';
        const date = new Date().toLocaleDateString();
        ctx.fillText(`Awarded on: ${date}`, canvas.width / 2, 520);
        ctx.fillText('Roman Numerals Adventure Academy', canvas.width / 2, 550);

        // Trigger a .pdf document download
        const a = document.createElement('a');
        a.href = canvas.toDataURL('image/png');
        a.download = 'roman-numerals-certificate.png';
        a.click();
    };
}

        /* ========= INITIALISATION ========= */

        renderHistoryFacts();          // show any previously unlocked facts
        selectCharacter('centurion');  // default hero + corner portrait
        showSection('story');          // default view when the page loads
    </script>
</body>
</html>
