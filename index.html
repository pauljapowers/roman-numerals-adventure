<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Roman Numerals Adventure</title>

    <!--
        Roman Numerals Adventure
        Complete single–file HTML, CSS and JS.
        IMPORTANT PATH NOTE:
        - These three images are loaded from the ROOT of the repo:
            ancient-rome.png
            roman-character-1.png   (Centurion)
            roman-character-2.png   (Scholar)
        - All faun / monster / clock art is loaded from the images/ folder.
    -->
    <style>
        /* ====== GLOBAL LAYOUT & BACKGROUND ====== */

        body {
            font-family: Arial, sans-serif;
            /* Background art from ROOT (as requested) */
            background: url("ancient-rome.png") no-repeat center center fixed;
            background-size: cover;
            margin: 0;
            padding: 20px;
        }

        /* Main white content card */
        .container {
            max-width: 1000px;
            margin: auto;
            background: rgba(255, 255, 255, 0.95);
            padding: 20px 30px 40px 30px;
            border-radius: 10px;
        }

        h1 {
            text-align: center;
            margin-top: 0;
        }

        h2 {
            margin-top: 10px;
        }

        /* Top navigation bar */
        #nav {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 8px;
            margin-bottom: 20px;
        }

        button {
            padding: 8px 12px;
            cursor: pointer;
        }

        input[type="text"] {
            padding: 5px;
            margin-top: 5px;
        }

        /* All main pages (sections) */
        .section {
            display: none;
        }

        /* Reusable “info box” style (like your Did you know? box) */
        .info-box {
            background-color: #fffde7;
            border: 1px solid #ffd54f;
            border-left: 5px solid #fbc02d;
            padding: 15px;
            margin-top: 10px;
            border-radius: 4px;
        }

        /* ====== FIXED GUIDE CHARACTER (BOTTOM‑RIGHT) ====== */

        #character {
            position: fixed;
            bottom: 10px;
            right: 10px;
            width: 220px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 8px;
            padding: 8px;
            box-shadow: 0 0 4px rgba(0,0,0,0.3);
            z-index: 50;
        }

        #character img {
            max-width: 100%;
            display: block;
        }

        #speech {
            background: #fff;
            border: 1px solid #ccc;
            padding: 5px;
            border-radius: 5px;
            margin-top: 5px;
            font-size: 0.85rem;
        }

        /* ====== DRAG / DROP COMMON STYLES ====== */

        .draggable {
            display: inline-block;
            padding: 10px;
            background: #eee;
            margin: 5px;
            cursor: move;
            border-radius: 4px;
        }

        #dropzone {
            border: 2px dashed #000;
            min-height: 60px;
            padding: 10px;
            margin: 10px 0;
        }

        /* ====== MATCHING GAME ====== */

        #matching .pair {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 10px 0;
        }

        #matching .drop {
            border: 1px solid #000;
            width: 100px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* ====== CONTENT IMAGES ====== */

        img.content-image {
            max-width: 100%;
            height: auto;
            margin: 15px 0;
            border-radius: 6px;
            display: block;
        }

        /* ====== ARENA / BATTLE ====== */

        #battle-arena {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 10px 0 20px 0;
        }

        .fighter img {
            max-width: 160px;
        }

        #health-bars {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-weight: bold;
        }

        /* ====== CHARACTER SELECT ====== */

        #character-options {
            display: flex;
            gap: 20px;
            align-items: flex-start;
            flex-wrap: wrap;
        }

        #character-options .hero-card {
            border: 1px solid #ccc;
            border-radius: 8px;
            padding: 10px;
            width: 220px;
            background: #fafafa;
            cursor: pointer;
        }

        #character-options .hero-card img {
            max-width: 100%;
            border-radius: 6px;
        }

        #character-options .hero-card.selected {
            border: 3px solid #5a94ff;
            box-shadow: 0 0 6px rgba(90,148,255,0.6);
        }

        /* ====== HISTORY FACTS ====== */

        #history-facts p {
            margin-bottom: 8px;
        }

        /* ====== TOOLS SECTION WRAPPER ====== */

        #tools-nav {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .tool-panel {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Roman Numerals Adventure</h1>

        <!-- Navigation bar. Each button shows one section. -->
        <div id="nav">
            <button onclick="showSection('story')">Story</button>
            <button onclick="showSection('tutorial')">Tutorial</button>
            <button onclick="showSection('character-select')">Character</button>
            <button onclick="showSection('history')">History</button>
            <button onclick="showSection('tools')">Tools</button>
            <button onclick="showSection('quiz')">Arena</button>
            <button onclick="downloadCertificate()">Certificate</button>
            <button onclick="showSection('highscore')">High Score</button>
            <input type="text" id="player-name" placeholder="Your name" />
        </div>

        <!-- ====== STORY / NARRATIVE ====== -->
        <div id="story" class="section">
            <h2>Story</h2>

            <!-- Guide Cato introduces the mission -->
            <div style="display:flex; align-items:center; gap:16px; margin-top:10px;">
                <img src="images/monster-1-faun-1.png" alt="Cato the faun guide" style="max-width:120px;">
                <p>
                    “Salve! I am <strong>Cato</strong>, your clever guide through ancient Rome.
                    My name means ‘wise’, so listen closely! This adventure will teach you how
                    Romans wrote numbers, how they lived, and how brave heroes like you can
                    defeat trickster monsters in the Arena of Numbers.”
                </p>
            </div>

            <!-- Did you know box -->
            <div class="info-box">
                <strong>Did you know?</strong>
                <br>
                Cato is pronounced <em>KAH-toh</em>. In Classical Latin the letter “C” always
                sounds like a hard “k”, just like in the word “cat”.
            </div>

            <p>
                You are a young scribe in ancient Rome, chosen by the Senate to keep
                track of armies, festivals, and treasure. To prove yourself worthy,
                you must master Roman numerals and record every victory and festival correctly.
            </p>
            <p>
                But Rome is full of magical creatures. A playful trickster called Faun
                has enchanted the numbers in the Arena. Each time you answer a question
                correctly, his magic grows weaker. Each time you make a mistake, he grows stronger.
            </p>
            <p>
                Every battle you win unlocks new secrets about Rome’s history and language.
                You will learn words like <strong>legion</strong> (a large Roman army),
                <strong>Senate</strong> (the council of leaders), and
                <strong>scribe</strong> (a person who writes official records).
            </p>

            <h3>How to use this adventure</h3>
            <ol style="margin-left: 1.5rem; list-style-type: upper-roman;">
                <li>Begin with the <strong>Story</strong> and <strong>Tutorial</strong> to learn the basics.</li>
                <li>Choose your hero on the <strong>Character</strong> page: Centurion or Scholar.</li>
                <li>Visit <strong>History</strong> to read fun facts about ancient Rome.</li>
                <li>Practise in <strong>Tools</strong> using the Converter, Builder, and Matching games.</li>
                <li>Enter the <strong>Arena</strong> to battle Faun with your maths skills.</li>
                <li>Download your <strong>Certificate</strong> and check the <strong>High Score</strong> board.</li>
            </ol>

            <!-- Extra hero image of Rome, loaded from ROOT for consistency -->
            <img src="ancient-rome.png"
                 alt="Ancient Roman forum with temples and people"
                 class="content-image" />
        </div>

        <!-- ====== TUTORIAL ====== -->
        <div id="tutorial" class="section">
            <h2>Tutorial</h2>

            <div style="display:flex; align-items:center; gap:16px; margin-top:10px;">
                <img src="images/monster-1-faun-2.png" alt="Cato teaching" style="max-width:120px;">
                <p>
                    “I, Cato the Faun, will teach you the rules of Roman numerals.
                    Learn them well, and you will be ready to challenge me in the Arena!”
                </p>
            </div>

            <p>Rules: I = 1, V = 5, X = 10, L = 50, C = 100, D = 500, M = 1000.</p>
            <p>Subtractive forms: IV = 4, IX = 9, XL = 40, XC = 90, CD = 400, CM = 900.</p>

            <img src="images/roman-clock.png"
                 alt="Clock face with Roman numerals"
                 class="content-image" />

            <p>
                Modern use: Roman numerals still appear on clocks, in book chapters,
                and at the end of films (for example, MMXXVI = 2026).
            </p>

            <h3>How to use this site (Step‑by‑step)</h3>
            <ol style="list-style-type: upper-roman; margin-left: 1.5rem;">
                <li>Read the rules for Roman numerals at the top of this page.</li>
                <li>Look at the clock and say each numeral out loud from I to XII.</li>
                <li>Use the <strong>Converter</strong> to practise turning numbers into numerals and back.</li>
                <li>Use the <strong>Builder</strong> to drag I, V, X, L, C, D, M and see how they combine.</li>
                <li>Play the <strong>Matching</strong> game to speed up your recognition.</li>
                <li>Enter the <strong>Arena</strong> when you feel ready to battle with maths.</li>
            </ol>
        </div>

        <!-- ====== CHARACTER SELECTION ====== -->
        <div id="character-select" class="section">
            <h2>Choose Your Champion</h2>

            <div class="info-box">
                <strong>Cato says:</strong>
                “Every hero needs a guide. Choose the champion who feels most like you.
                I will walk beside you either way!”
            </div>

            <p>Select a character to guide you through the Arena of Numbers.</p>

            <div id="character-options">
                <!-- Centurion card (image from ROOT) -->
                <div class="hero-card" id="card-centurion" onclick="selectCharacter('centurion')">
                    <img src="roman-character-1.png" alt="Centurion hero">
                    <h3>Centurion</h3>
                    <p>
                        A brave Roman officer who leads a <strong>century</strong> of 100 soldiers.
                        The Centurion loves bold challenges, quick battles, and shouting numbers across
                        the Arena so everyone can hear.
                    </p>
                </div>

                <!-- Scholar card (image from ROOT) -->
                <div class="hero-card" id="card-scholar" onclick="selectCharacter('scholar')">
                    <img src="roman-character-2.png" alt="Scholar hero">
                    <h3>Scholar</h3>
                    <p>
                        A thoughtful student from the great libraries of Rome.
                        The Scholar prefers careful thinking, clever strategies, and
                        solving tricky numeral puzzles before stepping into the Arena.
                    </p>
                </div>
            </div>
        </div>

        <!-- ====== HISTORY (simple facts for now) ====== -->
        <div id="history" class="section">
            <h2>History & Background</h2>

            <div class="info-box">
                <strong>Cato whispers:</strong>
                “As you rise through the levels, I will reveal more secrets about
                Rome’s roads, buildings, and clever inventions.”
            </div>

            <p>
                Win battles in the Arena to unlock new secrets about Roman numerals and
                ancient Rome. Each level can reveal a new fact below.
            </p>
            <div id="history-facts"></div>
        </div>

        <!-- ====== TOOLS WRAPPER (Converter, Builder, Matching) ====== -->
        <div id="tools" class="section">
            <h2>Tools</h2>

            <div id="tools-nav">
                <button onclick="showTool('tool-converter')">Converter</button>
                <button onclick="showTool('tool-builder')">Builder</button>
                <button onclick="showTool('tool-matching')">Matching</button>
            </div>

            <!-- Converter tool -->
            <div id="tool-converter" class="tool-panel">
                <h3>Converter</h3>
                <div class="info-box">
                    <img src="images/monster-1-faun-left-1.png" alt="Cato helper" style="max-width:80px; float:left; margin-right:10px;">
                    <p>
                        “Type a regular number, like <strong>27</strong>, and press Convert
                        to see its Roman numeral (<strong>XXVII</strong>). Or type a Roman
                        numeral, like <strong>XL</strong>, to see the number <strong>40</strong>.
                        Try to guess the answer before the converter shows it!”
                    </p>
                    <div style="clear:both;"></div>
                </div>
                <p><strong>Try it:</strong></p>
                <input type="text" id="input" placeholder="Number or Roman">
                <button onclick="convertInput()">Convert</button>
                <div id="result" style="margin-top:8px; font-weight:bold;"></div>
            </div>

            <!-- Builder tool -->
            <div id="tool-builder" class="tool-panel">
                <h3>Drag‑and‑Drop Builder</h3>
                <div class="info-box">
                    <img src="images/monster-1-faun-left-1.png" alt="Cato builder" style="max-width:80px; float:left; margin-right:10px;">
                    <p>
                        “Welcome, Roman! Drag the symbols I, V, X, L, C, D, and M into the box
                        to build your own numerals. Watch how the value changes as you add or
                        remove symbols. Can you build the number <strong>2026</strong>?”
                    </p>
                    <div style="clear:both;"></div>
                </div>
                <p>Drag symbols to build a Roman numeral and see its value.</p>
                <div>
                    <div class="draggable" draggable="true" ondragstart="drag(event)" id="I">I</div>
                    <div class="draggable" draggable="true" ondragstart="drag(event)" id="V">V</div>
                    <div class="draggable" draggable="true" ondragstart="drag(event)" id="X">X</div>
                    <div class="draggable" draggable="true" ondragstart="drag(event)" id="L">L</div>
                    <div class="draggable" draggable="true" ondragstart="drag(event)" id="C">C</div>
                    <div class="draggable" draggable="true" ondragstart="drag(event)" id="D">D</div>
                    <div class="draggable" draggable="true" ondragstart="drag(event)" id="M">M</div>
                </div>
                <div id="dropzone" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
                <div id="build-result" style="font-weight:bold; margin-top:5px;"></div>
                <button onclick="resetBuilder()">Reset</button>
            </div>

            <!-- Matching tool -->
            <div id="tool-matching" class="tool-panel">
                <h3>Matching Game</h3>
                <div class="info-box">
                    <img src="images/monster-1-faun-right-2.png" alt="Cato matching" style="max-width:80px; float:left; margin-right:10px;">
                    <p>
                        “Here is a quick challenge! Drag each Roman numeral into the
                        box that shows its number. Remember: I is 1, V is 5, and X is 10.
                        Try to match them all without a single mistake.”
                    </p>
                    <div style="clear:both;"></div>
                </div>
                <p>Drag Roman numerals to match the numbers.</p>
                <div>
                    <div class="draggable" draggable="true" ondragstart="drag(event)" id="match-I">I</div>
                    <div class="draggable" draggable="true" ondragstart="drag(event)" id="match-V">V</div>
                    <div class="draggable" draggable="true" ondragstart="drag(event)" id="match-X">X</div>
                </div>
                <div class="pair">V (5):
                    <div class="drop" ondrop="dropMatch(event, 5)" ondragover="allowDrop(event)"></div>
                </div>
                <div class="pair">I (1):
                    <div class="drop" ondrop="dropMatch(event, 1)" ondragover="allowDrop(event)"></div>
                </div>
                <div class="pair">X (10):
                    <div class="drop" ondrop="dropMatch(event, 10)" ondragover="allowDrop(event)"></div>
                </div>
                <div id="match-result" style="margin-top:5px; font-weight:bold;"></div>
            </div>
        </div>

        <!-- ====== ARENA / BATTLE QUIZ ====== -->
        <div id="quiz" class="section">
            <h2>Arena Battle</h2>

            <div class="info-box">
                <strong>Cato explains:</strong>
                “In the Arena, your hero faces me, the trickster Faun. Each correct Roman numeral
                hits me. Each mistake hits you. Survive ten questions or defeat me to win the round!”
            </div>

            <p>
                Level <span id="level">1</span>.
                Total score: <span id="score">0</span>
            </p>
            <p>Each battle has up to 10 questions. Correct answers damage the monster, wrong answers hurt you.</p>

            <div id="health-bars">
                <div>Hero HP: <span id="hero-hp">5</span></div>
                <div>Monster HP: <span id="monster-hp">5</span></div>
            </div>

            <div id="battle-arena">
                <div class="fighter">
                    <!-- Hero image (Centurion or Scholar) from ROOT -->
                    <img id="hero-img" src="roman-character-1.png" alt="Hero">
                </div>
                <div class="fighter">
                    <!-- Monster: Faun, from images/ -->
                    <img id="monster-img" src="images/monster-1-faun-right-2.png" alt="Faun monster">
                </div>
            </div>

            <p>Round score: <span id="round-score">0</span> / 10</p>
            <div id="question" style="margin-bottom:5px;"></div>
            <input type="text" id="quiz-input" autocomplete="off">
            <button onclick="checkQuiz()">Submit</button>
            <div id="quiz-result" style="margin-top:5px; font-weight:bold;"></div>
        </div>

        <!-- ====== HIGH SCORE (placeholder for now) ====== -->
        <div id="highscore" class="section">
            <h2>High Score</h2>
            <p>
                This page will list the highest scores from brave players around the world.
                For now, keep battling in the Arena to build your score!
            </p>
        </div>
    </div>

    <!-- Fixed guide character (uses chosen hero art from ROOT) -->
    <div id="character">
        <img id="corner-character" src="roman-character-1.png" alt="Guide character">
        <div id="speech">Welcome to the Arena of Numbers!</div>
    </div>

    <!-- Hidden canvas for certificate rendering -->
    <canvas id="cert-canvas" style="display:none;"></canvas>

    <script>
        /* ========= GLOBAL STATE & PERSISTENCE ========= */

        // Score and level (persisted in localStorage)
        let score = parseInt(localStorage.getItem('score') || '0', 10);
        let level = parseInt(localStorage.getItem('level') || '1', 10);
        document.getElementById('score').innerText = score;
        document.getElementById('level').innerText = level;

        // Active hero: "centurion" or "scholar"
        let selectedCharacter = 'centurion';

        // Short history facts unlocked per level
        const historyFacts = [
            "Romans used numerals mainly for counting money, recording trade, and numbering armies.",
            "Romans did not have a symbol for zero. The idea of zero came later from other cultures.",
            "Romans wrote numbers on wax tablets, stone, and metal, often carved into monuments.",
            "On old clocks and buildings you often see 'IIII' for 4 instead of 'IV'.",
            "Roman numerals are still used today for book chapters, movie dates, and royal names."
        ];
        let unlockedFacts = parseInt(localStorage.getItem('factsUnlocked') || '1', 10);

        function renderHistoryFacts() {
            const container = document.getElementById('history-facts');
            container.innerHTML = '';
            for (let i = 0; i < unlockedFacts && i < historyFacts.length; i++) {
                const p = document.createElement('p');
                p.textContent = historyFacts[i];
                container.appendChild(p);
            }
        }

        /* ========= NAVIGATION ========= */

        function showSection(id) {
            document.querySelectorAll('.section').forEach(s => s.style.display = 'none');
            const section = document.getElementById(id);
            if (section) section.style.display = 'block';

            if (id === 'quiz') startQuiz();
            if (id === 'tools') showTool('tool-converter'); // default tool
        }

        function showTool(id) {
            document.querySelectorAll('.tool-panel').forEach(p => p.style.display = 'none');
            const panel = document.getElementById(id);
            if (panel) panel.style.display = 'block';
        }

        /* ========= ROMAN NUMERAL UTILITIES ========= */

        const romanMap = [
            { value: 1000, numeral: "M" }, { value: 900, numeral: "CM" }, { value: 500, numeral: "D" },
            { value: 400, numeral: "CD" }, { value: 100, numeral: "C" }, { value: 90, numeral: "XC" },
            { value: 50, numeral: "L" }, { value: 40, numeral: "XL" }, { value: 10, numeral: "X" },
            { value: 9, numeral: "IX" }, { value: 5, numeral: "V" }, { value: 4, numeral: "IV" }, { value: 1, numeral: "I" }
        ];

        function numberToRoman(num) {
            let result = "";
            for (let { value, numeral } of romanMap) {
                while (num >= value) { result += numeral; num -= value; }
            }
            return result;
        }

        const romanToNumMap = {
            M: 1000, CM: 900, D: 500, CD: 400,
            C: 100, XC: 90, L: 50, XL: 40,
            X: 10, IX: 9, V: 5, IV: 4, I: 1
        };

        function romanToNumber(roman) {
            let i = 0, num = 0;
            roman = roman.toUpperCase();
            while (i < roman.length) {
                const two = roman[i] + (roman[i + 1] || "");
                if (romanToNumMap[two]) { num += romanToNumMap[two]; i += 2; }
                else { num += romanToNumMap[roman[i]]; i++; }
            }
            return num;
        }

        function convertInput() {
            const inputEl = document.getElementById('input');
            if (!inputEl) return;
            let input = inputEl.value.trim().toUpperCase();
            const result = document.getElementById('result');
            if (!input) {
                result.innerText = "Please enter a number or Roman numeral.";
                return;
            }
            if (!isNaN(input)) {
                let num = parseInt(input, 10);
                if (num < 1 || num > 3999) {
                    result.innerText = "Please enter a number from 1 to 3999.";
                } else {
                    result.innerText = numberToRoman(num);
                }
            } else {
                result.innerText = romanToNumber(input);
            }
        }

        /* ========= DRAG & DROP BUILDER ========= */

        function allowDrop(ev) { ev.preventDefault(); }

        function drag(ev) {
            ev.dataTransfer.setData("text", ev.target.id);
        }

        function drop(ev) {
            ev.preventDefault();
            const id = ev.dataTransfer.getData("text");
            const original = document.getElementById(id);
            if (!original) return;
            const node = original.cloneNode(true);
            node.id = id + "-copy-" + Date.now();
            ev.target.appendChild(node);

            const roman = ev.target.innerText.replace(/\s+/g, '');
            const value = roman ? romanToNumber(roman) : '';
            document.getElementById('build-result').innerText = value;
        }

        function resetBuilder() {
            document.getElementById('dropzone').innerHTML = '';
            document.getElementById('build-result').innerText = '';
        }

        /* ========= CHARACTER SELECTION ========= */

        function selectCharacter(id) {
            selectedCharacter = id;

            // Corner guide portrait (from ROOT)
            document.getElementById('corner-character').src =
                id === 'scholar'
                    ? 'roman-character-2.png'
                    : 'roman-character-1.png';

            document.getElementById('speech').innerText =
                id === 'scholar'
                    ? 'You chose the Scholar! Think carefully and strike wisely.'
                    : 'You chose the Centurion! Charge bravely into the Arena.';

            // Highlight selected hero card
            document.querySelectorAll('#character-options .hero-card')
                .forEach(card => card.classList.remove('selected'));
            if (id === 'scholar') {
                document.getElementById('card-scholar').classList.add('selected');
            } else {
                document.getElementById('card-centurion').classList.add('selected');
            }
        }

        /* ========= ARENA / QUIZ BATTLE ========= */

        let heroHp = 5;
        let monsterHp = 5;
        let questionsThisRound = 0;
        let currentQuestion = null;

        function startQuiz() {
            // Update hero art based on chosen character (ROOT paths)
            const heroImg = document.getElementById('hero-img');
            heroImg.src =
                selectedCharacter === 'scholar'
                    ? 'roman-character-2.png'
                    : 'roman-character-1.png';

            if (questionsThisRound === 0) {
                heroHp = 5;
                monsterHp = 5;
                document.getElementById('hero-hp').innerText = heroHp;
                document.getElementById('monster-hp').innerText = monsterHp;
                document.getElementById('round-score').innerText = 0;
                document.getElementById('quiz-result').innerText = '';
            }

            const maxBase = level * 10;
            let a = Math.floor(Math.random() * maxBase) + 1;
            let b = Math.floor(Math.random() * maxBase) + 1;
            let op = '+';
            if (level >= 3 && level <= 4) op = '-';
            if (level >= 5 && level <= 6) op = '×';
            if (level >= 7) op = '÷';

            let correctNumber;
            if (op === '+') {
                correctNumber = a + b;
            } else if (op === '-') {
                const max = Math.max(a, b);
                const min = Math.min(a, b);
                a = max; b = min;
                correctNumber = a - b;
            } else if (op === '×') {
                correctNumber = a * b;
            } else { // division
                correctNumber = a;
                b = Math.max(1, Math.floor(Math.random() * (level + 1)));
                a = correctNumber * b;
            }

            currentQuestion = { a, b, op, correctNumber };
            const romanA = numberToRoman(a);
            const romanB = numberToRoman(b);
            document.getElementById('question').innerText =
                `Arena Challenge: ${romanA} ${op} ${romanB} = ? (answer in Roman numerals)`;
            const input = document.getElementById('quiz-input');
            input.value = '';
            input.focus();
        }

        function checkQuiz() {
            if (!currentQuestion) return;

            const input = document.getElementById('quiz-input').value.trim().toUpperCase();
            if (!input) return;

            const result = document.getElementById('quiz-result');
            questionsThisRound++;

            const correctRoman = numberToRoman(currentQuestion.correctNumber);
            const correct = (input === correctRoman);

            if (correct) {
                monsterHp--;
                score++;
                document.getElementById('monster-hp').innerText = monsterHp;
                document.getElementById('round-score').innerText =
                    parseInt(document.getElementById('round-score').innerText, 10) + 1;
                document.getElementById('speech').innerText = 'You strike the monster!';
                result.innerText = 'Correct!';
            } else {
                heroHp--;
                document.getElementById('hero-hp').innerText = heroHp;
                document.getElementById('speech').innerText =
                    `The monster hits back! The correct answer was ${correctRoman}.`;
                result.innerText = `Wrong. Correct: ${correctRoman}`;
            }

            localStorage.setItem('score', score);
            document.getElementById('score').innerText = score;

            if (heroHp <= 0 || monsterHp <= 0 || questionsThisRound >= 10) {
                if (monsterHp <= 0 && heroHp > 0) {
                    level++;
                    localStorage.setItem('level', level);
                    document.getElementById('level').innerText = level;

                    if (unlockedFacts < historyFacts.length) {
                        unlockedFacts++;
                        localStorage.setItem('factsUnlocked', unlockedFacts);
                        renderHistoryFacts();
                        document.getElementById('speech').innerText =
                            'Victory! You move to the next arena and unlock a new secret of Rome.';
                    } else {
                        document.getElementById('speech').innerText =
                            'Victory! You have uncovered all the known secrets of Rome.';
                    }
                } else if (heroHp <= 0) {
                    document.getElementById('speech').innerText =
                        'Defeat... but you can try the level again.';
                }
                questionsThisRound = 0;
            }

            if (heroHp > 0 && monsterHp > 0 && questionsThisRound < 10) {
                startQuiz();
            }
        }

        /* ========= MATCHING GAME ========= */

        function dropMatch(ev, num) {
            ev.preventDefault();
            const id = ev.dataTransfer.getData("text");
            const symbol = document.getElementById(id).innerText.trim();
            if (romanToNumber(symbol) === num) {
                ev.target.innerText = symbol;
                document.getElementById('match-result').innerText = 'Match!';
                document.getElementById('speech').innerText = 'Good match!';
            } else {
                document.getElementById('match-result').innerText = 'Try again.';
                document.getElementById('speech').innerText = 'No match this time.';
            }
        }

        /* ========= CERTIFICATE (CANVAS) ========= */

        function downloadCertificate() {
            const canvas = document.getElementById('cert-canvas');
            const ctx = canvas.getContext('2d');
            const name = document.getElementById('player-name').value || 'Brave Student';

            canvas.width = 800;
            canvas.height = 600;

            ctx.fillStyle = '#fdf6e3';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            ctx.strokeStyle = '#8b5a2b';
            ctx.lineWidth = 10;
            ctx.strokeRect(20, 20, canvas.width - 40, canvas.height - 40);

            ctx.fillStyle = '#000';
            ctx.textAlign = 'center';

            ctx.font = '36px Georgia';
            ctx.fillText('Certificate of Achievement', canvas.width / 2, 100);
            ctx.font = '28px Georgia';
            ctx.fillText('Roman Numerals Adventure', canvas.width / 2, 150);

            ctx.font = '24px Georgia';
            ctx.fillText(name, canvas.width / 2, 210);
            ctx.font = '20px Georgia';
            const heroLabel = selectedCharacter === 'scholar'
                ? 'Scholar of Numbers'
                : 'Centurion of Counting';
            ctx.fillText(heroLabel, canvas.width / 2, 240);

            const levelRoman = numberToRoman(level);
            ctx.font = '20px Georgia';
            ctx.fillText(`Score: ${score}`, canvas.width / 2, 280);
            ctx.fillText(`Level: ${levelRoman} (${level} of XX)`, canvas.width / 2, 310);

            ctx.font = '18px Georgia';
            ctx.fillText(
                `Well done, ${name}! You defeated the trickster known as Faun.`,
                canvas.width / 2, 350
            );

            const logo = new Image();
            // Use logo image as requested, from images/ folder
            logo.src = 'images/monster-1-faun-logo-1.png';
            logo.onload = () => {
                const size = 100;
                ctx.drawImage(logo, canvas.width / 2 - size / 2, 370, size, size);

                ctx.font = '16px Georgia';
                const date = new Date().toLocaleDateString();
                ctx.fillText(`Awarded on: ${date}`, canvas.width / 2, 520);
                ctx.fillText('Roman Numerals Adventure Academy', canvas.width / 2, 550);

                const a = document.createElement('a');
                a.href = canvas.toDataURL('image/png');
                a.download = 'roman-numerals-certificate.png';
                a.click();
            };
        }

        /* ========= INITIALISATION ========= */

        renderHistoryFacts();
        selectCharacter('centurion');
        showSection('story');
    </script>
</body>
</html>
